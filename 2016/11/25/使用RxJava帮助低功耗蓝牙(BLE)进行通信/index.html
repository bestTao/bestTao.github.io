<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="åŸºç¡€æ•™ç¨‹ï¼åŸºç¡€æ•™ç¨‹ï¼">
<meta name="keywords" content="Android,RxJava,è“ç‰™">
<meta property="og:type" content="article">
<meta property="og:title" content="RxJava + BLE">
<meta property="og:url" content="https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/index.html">
<meta property="og:site_name" content="Salama">
<meta property="og:description" content="åŸºç¡€æ•™ç¨‹ï¼åŸºç¡€æ•™ç¨‹ï¼">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/82890cf6ly1g0svkchadyj20nw0nw40x.jpg">
<meta property="og:updated_time" content="2019-03-06T03:01:21.277Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RxJava + BLE">
<meta name="twitter:description" content="åŸºç¡€æ•™ç¨‹ï¼åŸºç¡€æ•™ç¨‹ï¼">
<meta name="twitter:image" content="https://ws1.sinaimg.cn/large/82890cf6ly1g0svkchadyj20nw0nw40x.jpg">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>RxJava + BLE</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">ä¸»é¡µ</a></li>
         
          <li><a href="/archives/">åˆ—è¡¨</a></li>
         
          <li><a href="/emmm/">ç‰¢éªš</a></li>
         
          <li><a href="/about/">æˆ‘</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2016/11/30/[è¯‘]åŠ¨ç”»çŸ¢é‡å›¾(ç®€å•å‡ æ­¥å°±èƒ½åŠ¨èµ·æ¥)/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2016/11/09/å¹´å‰ä¹¦å•è®¡åˆ’/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&text=RxJava + BLE"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&title=RxJava + BLE"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&is_video=false&description=RxJava + BLE"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=RxJava + BLE&body=Check out this article: https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&title=RxJava + BLE"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&title=RxJava + BLE"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&title=RxJava + BLE"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&title=RxJava + BLE"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&name=RxJava + BLE&description=&lt;p&gt;åŸºç¡€æ•™ç¨‹ï¼åŸºç¡€æ•™ç¨‹ï¼&lt;br&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#æ•´ä½“æ€è·¯"><span class="toc-number">1.</span> <span class="toc-text">æ•´ä½“æ€è·¯</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#è¯¦ç»†æ­¥éª¤"><span class="toc-number">2.</span> <span class="toc-text">è¯¦ç»†æ­¥éª¤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#è®¾ç½®è“ç‰™æƒé™"><span class="toc-number">2.1.</span> <span class="toc-text">è®¾ç½®è“ç‰™æƒé™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è®¾ç½®å¹¶å¼€å¯æ‰‹æœºè“ç‰™è®¾å¤‡"><span class="toc-number">2.2.</span> <span class="toc-text">è®¾ç½®å¹¶å¼€å¯æ‰‹æœºè“ç‰™è®¾å¤‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æŸ¥æ‰¾è“ç‰™è®¾å¤‡"><span class="toc-number">2.3.</span> <span class="toc-text">æŸ¥æ‰¾è“ç‰™è®¾å¤‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è¿æ¥è“ç‰™æœåŠ¡å¹¶æ¥æ”¶æ•°æ®"><span class="toc-number">2.4.</span> <span class="toc-text">è¿æ¥è“ç‰™æœåŠ¡å¹¶æ¥æ”¶æ•°æ®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¸€ã€onConnectionStateChange"><span class="toc-number">2.4.0.1.</span> <span class="toc-text">ä¸€ã€onConnectionStateChange</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#äºŒã€onServicesDiscovered"><span class="toc-number">2.4.0.2.</span> <span class="toc-text">äºŒã€onServicesDiscovered</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¸‰ã€onCharacteristicChanged"><span class="toc-number">2.4.0.3.</span> <span class="toc-text">ä¸‰ã€onCharacteristicChanged</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‘è“ç‰™è®¾å¤‡å‘é€æ•°æ®"><span class="toc-number">2.5.</span> <span class="toc-text">å‘è“ç‰™è®¾å¤‡å‘é€æ•°æ®</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        RxJava + BLE
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Salama</span>
      </span>
      
    <div class="postdate">
        <time datetime="2016-11-25T11:54:50.000Z" itemprop="datePublished">2016-11-25</time>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Android/">Android</a>, <a class="tag-link" href="/tags/RxJava/">RxJava</a>, <a class="tag-link" href="/tags/è“ç‰™/">è“ç‰™</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>åŸºç¡€æ•™ç¨‹ï¼åŸºç¡€æ•™ç¨‹ï¼<br><a id="more"></a></p>
<blockquote>
<p>å…³äº RxJavaï¼Œå¦‚æœä½ è¿˜ä¸äº†è§£ï¼Œå¯ä»¥çœ‹<a href="http://gank.io/post/560e15be2dca930e00da1083" target="_blank" rel="noopener">ç»™ Android å¼€å‘è€…çš„ RxJava è¯¦è§£</a><br>å…³äºä½åŠŸè€—è“ç‰™çš„å¼€å‘ä½ å¯ä»¥çœ‹<a href="https://developer.android.com/guide/topics/connectivity/bluetooth-le.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>æˆ–è€…ç›´æ¥é˜…è¯»æœ¬æ–‡</p>
</blockquote>
<p>Android ä¸­çš„è“ç‰™å¼€å‘æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¼ ç»Ÿè“ç‰™ï¼Œå¦ä¸€ç§æ˜¯ä½åŠŸè€—è“ç‰™ï¼Œè¿™ä¸¤è€…å®Œå…¨ä¸ä¸€æ ·ï¼Œå¼€å‘å‰ä½ å¾—å¼„æ¸…ä½ éœ€è¦å¼€å‘çš„æ˜¯å“ªä¸€ç§ï¼Œç”¨ä¼ ç»Ÿè“ç‰™çš„æ–¹å¼è¿›è¡Œä½åŠŸè€—è“ç‰™çš„å¼€å‘ä½ å¯èƒ½éƒ½æ²¡æ³•ä½¿ä½ çš„è®¾å¤‡è¿ä¸Šè“ç‰™ï¼Œä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆçŸ¥é“ï¼Œè¯´å¤šäº†éƒ½æ˜¯æ³ª (TT)<br><br><br>ä½åŠŸè€—è“ç‰™ï¼ˆBluetooth Low Energyï¼‰ç®€ç§° BLE, å¸¸è§äºå„ç§è¿åŠ¨æ‰‹ç¯ã€ç”µå­è¡€å‹è®¡ç­‰å¥åº·ç®¡ç†è®¾å¤‡ï¼ŒAndroid 4.3ï¼ˆ API çº§åˆ« 18 ï¼‰ä¸­å¼•å…¥äº†é¢å‘ä½åŠŸè€—è“ç‰™çš„APIæ”¯æŒã€‚ä¹Ÿå°±æ˜¯è¯´å¼€å‘çš„å‰ææ˜¯æ‰‹æœºè®¾å¤‡æ”¯æŒBLEå¹¶ä¸”ç³»ç»Ÿæ˜¯ Android 4.3 ä»¥ä¸Šï¼Œä¸æ‰‹æœºé€šä¿¡çš„è“ç‰™è®¾å¤‡æ˜¯ä½åŠŸè€—è“ç‰™ã€‚<br><br><br>å¦‚æœä½ çœ‹äº†<a href="https://developer.android.com/guide/topics/connectivity/bluetooth-le.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ä¸Šçš„ç¤ºä¾‹ï¼Œä½ ä¼šå‘ç°ä½¿ç”¨äº† Handlerã€å’Œå¹¿æ’­è¿›è¡Œå¼‚æ­¥é€šä¿¡ï¼Œç°åœ¨æœ‰äº† RxJavaï¼Œä½ å¯ä»¥ç”¨æ¢ä¸ªæ–¹å¼äº†ã€‚</p>
<h1 id="æ•´ä½“æ€è·¯"><a href="#æ•´ä½“æ€è·¯" class="headerlink" title="æ•´ä½“æ€è·¯"></a>æ•´ä½“æ€è·¯</h1><p>å‡å®šä½ å·²ç»æœ‰äº†ä¸€éƒ¨æ”¯æŒ BLE çš„æ‰‹æœºå’Œä¸€ä¸ªå¯ä»¥é€šä¿¡çš„ä½åŠŸè€—è“ç‰™æ¨¡å—ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŒ‰ä¸‹é¢çš„æ­¥éª¤å¼€æäº†ï¼š</p>
<ul>
<li>è“ç‰™æƒé™</li>
<li>è®¾ç½®å¹¶å¼€å¯æ‰‹æœºè“ç‰™</li>
<li>æŸ¥æ‰¾è“ç‰™è®¾å¤‡</li>
<li>è¿æ¥è“ç‰™æœåŠ¡</li>
<li>è¿›è¡Œè“ç‰™é€šä¿¡</li>
</ul>
<h1 id="è¯¦ç»†æ­¥éª¤"><a href="#è¯¦ç»†æ­¥éª¤" class="headerlink" title="è¯¦ç»†æ­¥éª¤"></a>è¯¦ç»†æ­¥éª¤</h1><h2 id="è®¾ç½®è“ç‰™æƒé™"><a href="#è®¾ç½®è“ç‰™æƒé™" class="headerlink" title="è®¾ç½®è“ç‰™æƒé™"></a>è®¾ç½®è“ç‰™æƒé™</h2><p>åœ¨åº”ç”¨ä¸­çš„ manifest æ–‡ä»¶ä¸­å£°æ˜è“ç‰™æƒé™<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.BLUETOOTH"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.BLUETOOTH_ADMIN"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>å¦å¤–æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>PackageManager.hasSystemFeature()</code> æ–¹æ³•æ¥åˆ¤æ–­å½“å‰çš„æ‰‹æœºè®¾å¤‡æ˜¯å¦æ”¯æŒBLEã€‚</p>
<h2 id="è®¾ç½®å¹¶å¼€å¯æ‰‹æœºè“ç‰™è®¾å¤‡"><a href="#è®¾ç½®å¹¶å¼€å¯æ‰‹æœºè“ç‰™è®¾å¤‡" class="headerlink" title="è®¾ç½®å¹¶å¼€å¯æ‰‹æœºè“ç‰™è®¾å¤‡"></a>è®¾ç½®å¹¶å¼€å¯æ‰‹æœºè“ç‰™è®¾å¤‡</h2><p>é¦–å…ˆé€šè¿‡ <code>BluetoothManager</code> è·å–æ‰‹æœºä¸­å”¯ä¸€çš„çš„è“ç‰™é€‚é…å™¨(è“ç‰™å‘é€æ¥æ”¶å™¨) <code>BluetoothAdapter</code> å¯¹è±¡ã€‚å†é€šè¿‡ <code>BluetoothAdapter</code> å¼€å¯æ‰‹æœºè“ç‰™è®¾å¤‡ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initBle</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mContext = context.getApplicationContext();</span><br><span class="line">        BluetoothManager bluetoothManager =</span><br><span class="line">                (BluetoothManager) <span class="keyword">this</span>.mContext.getSystemService(Context.BLUETOOTH_SERVICE);</span><br><span class="line">        mBleAdapter = bluetoothManager.getAdapter();</span><br><span class="line">        <span class="keyword">if</span> (mBleAdapter != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mBleAdapter.enable();<span class="comment">//ä¸å¼¹å¯¹è¯æ¡†ç›´æ¥å¼€å¯è“ç‰™</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>å€¼å¾—ä¸€æçš„æ˜¯æˆ‘å°†è“ç‰™åŠŸèƒ½ç®€å•çš„å°è£…æˆäº†ä¸€ä¸ªå·¥å…·ç±»ï¼Œç”¨åˆ°äº†é™æ€å†…éƒ¨ç±»çš„å•ä¾‹æ¨¡å¼ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜æ³„éœ²ï¼Œåœ¨åˆå§‹åŒ–è“ç‰™çš„æ—¶å€™ä¼ å…¥äº† Application çš„ Context å¯¹è±¡çš„å¼•ç”¨</p>
<h2 id="æŸ¥æ‰¾è“ç‰™è®¾å¤‡"><a href="#æŸ¥æ‰¾è“ç‰™è®¾å¤‡" class="headerlink" title="æŸ¥æ‰¾è“ç‰™è®¾å¤‡"></a>æŸ¥æ‰¾è“ç‰™è®¾å¤‡</h2><p>å®šä¹‰äº†ä¸€ä¸ª <code>scanBleDevices(boolean enable)</code> æ–¹æ³•ç”¨äºå¼€å¯å’Œå…³é—­æ‰«æã€‚è¿™é‡Œä½¿ç”¨äº† <code>BluetoothAdapter.startLeScan(LeScanCallback)</code> æ–¹æ³•å¼€å¯æ‰«æï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªæ‰«æå›è°ƒï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> BluetoothAdapter.LeScanCallback mBleScanCallback = <span class="keyword">new</span> BluetoothAdapter.LeScanCallback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLeScan</span><span class="params">(BluetoothDevice bleDevice, <span class="keyword">int</span> rssi, <span class="keyword">byte</span>[] scanRecord)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mIsScanning) &#123;</span><br><span class="line">            Log.d(TAG, <span class="string">"onLeScanï¼šæ‰¾åˆ°è®¾å¤‡"</span> + bleDevice.getName());</span><br><span class="line">            <span class="keyword">if</span> (mTargetDeviceName.equals(bleDevice.getName())) &#123;</span><br><span class="line">                connectDevice(bleDevice);<span class="comment">//è¿æ¥è“ç‰™è®¾å¤‡</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.d(TAG, <span class="string">"onLeScan: åœæ­¢æ‰«æ"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå›è°ƒä¹Ÿç”¨äºå…³é—­è“ç‰™æ‰«æçš„æ–¹æ³• <code>BluetoothAdapter.stopLeScan(LeScanCallback)</code>ï¼Œæ‰€ä»¥å®šä¹‰äº†ä¸€ä¸ªå¸ƒå°”å‹å˜é‡ <code>mIsScanning</code> åˆ¤æ–­è“ç‰™æ‰«æçš„å¼€å¯å’Œå…³é—­ã€‚<br>ã€€ã€€è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬çš„ RxJava å¥½åƒè¿˜æ²¡ç™»åœºã€‚åœ¨æ‰«æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é™å®šè“ç‰™çš„æ‰«æçš„è¶…æ—¶æ—¶é—´ï¼Œä¸èƒ½è®©æ‰‹æœºè¿™ä¹ˆä¸€ç›´æ‰«æï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ RxJava ä¸­çš„<code>timer</code>å»¶æ—¶ä¸€æ®µæ—¶é—´åæ‰§è¡Œåœæ­¢æ‰«æï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Observable.timer(SCAN_PERIOD, TimeUnit.MILLISECONDS).subscribe(<span class="keyword">new</span> Action1&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Long aLong)</span> </span>&#123;</span><br><span class="line">        mIsScanning = <span class="keyword">false</span>;</span><br><span class="line">        mBleAdapter.stopLeScan(mBleScanCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="è¿æ¥è“ç‰™æœåŠ¡å¹¶æ¥æ”¶æ•°æ®"><a href="#è¿æ¥è“ç‰™æœåŠ¡å¹¶æ¥æ”¶æ•°æ®" class="headerlink" title="è¿æ¥è“ç‰™æœåŠ¡å¹¶æ¥æ”¶æ•°æ®"></a>è¿æ¥è“ç‰™æœåŠ¡å¹¶æ¥æ”¶æ•°æ®</h2><p>ã€€ã€€å½“æŸ¥æ‰¾åˆ°åä¸º <code>mTargetDeviceName</code> çš„ç›®æ ‡è“ç‰™è®¾å¤‡ï¼Œå°±å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•å»è¿æ¥ï¼Œå‡†ç¡®çš„è¯´æ˜¯è¿æ¥è®¾å¤‡ä¸Šçš„ GATT æœåŠ¡ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">connectDevice</span><span class="params">(BluetoothDevice bleDevice)</span> </span>&#123;</span><br><span class="line">    scanBleDevices(<span class="keyword">false</span>);</span><br><span class="line">    mBleGatt = bleDevice.connectGatt(mContext, <span class="keyword">true</span>, <span class="keyword">new</span> BleGattCallback());</span><br><span class="line">    mBleGatt.connect();</span><br><span class="line">    Log.d(TAG, <span class="string">"å¼€å§‹è¿æ¥è®¾å¤‡ï¼š"</span> + mBleGatt.getDevice().getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ã€€ã€€è¿æ¥è“ç‰™è®¾å¤‡å‰éœ€è¦å…³é—­è“ç‰™æ‰«æã€‚ <code>bleDevice.connectGatt(mContext, true, new BleGattCallback())</code> æ–¹æ³•è¿”å›äº†ä¸€ä¸ªè“ç‰™GATTå¯¹è±¡ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­çš„ <code>true</code> ä»£è¡¨è‡ªåŠ¨è¿æ¥ï¼ˆè“ç‰™æ¨¡å—æ–­ç”µé‡å¯åï¼Œå¯ä»¥é‡æ–°è¿æ¥å®ƒï¼‰ï¼Œè°ƒç”¨ GATT çš„ <code>connect()</code> æ–¹æ³•è¿›è¡Œè¿æ¥ï¼Œè¿æ¥è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œä¼ å…¥çš„å›è°ƒ <code>BleGattCallback</code>ï¼Œè¿™ä¸ªå›è°ƒç»§æ‰¿äº† <code>BluetoothGattCallback</code> å¹¶é‡å†™äº†ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<h4 id="ä¸€ã€onConnectionStateChange"><a href="#ä¸€ã€onConnectionStateChange" class="headerlink" title="ä¸€ã€onConnectionStateChange"></a><strong>ä¸€ã€onConnectionStateChange</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConnectionStateChange</span><span class="params">(BluetoothGatt bleGatt, <span class="keyword">int</span> status, <span class="keyword">int</span> newState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onConnectionStateChange(bleGatt, status, newState);</span><br><span class="line">    Log.d(TAG, <span class="string">"onConnectionStateChange: è¿æ¥çŠ¶æ€: "</span> + newState);</span><br><span class="line">    <span class="keyword">if</span> (newState == BluetoothGatt.STATE_CONNECTED) &#123;<span class="comment">//è¿æ¥æˆåŠŸ</span></span><br><span class="line">        Log.d(TAG, <span class="string">"onConnectionStateChange: è®¾å¤‡è¿æ¥"</span>);</span><br><span class="line">        bleGatt.discoverServices();<span class="comment">//æœç´¢æœåŠ¡</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newState == BluetoothGatt.STATE_DISCONNECTED) &#123;<span class="comment">//æ–­å¼€è¿æ¥</span></span><br><span class="line">        Log.d(TAG, <span class="string">"onConnectionStateChange: è®¾å¤‡æ–­å¼€"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•ç›‘å¬è¿æ¥çŠ¶æ€çš„æ”¹å˜ï¼Œè¿æ¥çŠ¶æ€æœ‰å››ä¸ªå€¼ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">å€¼</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">STATE_CONNECTED</td>
<td style="text-align:left">å·²è¿æ¥</td>
</tr>
<tr>
<td style="text-align:left">STATE_CONNECTING</td>
<td style="text-align:left">æ­£åœ¨è¿æ¥</td>
</tr>
<tr>
<td style="text-align:left">STATE_DISCONNECTED</td>
<td style="text-align:left">æ–­å¼€è¿æ¥</td>
</tr>
<tr>
<td style="text-align:left">STATE_DISCONNECTING</td>
<td style="text-align:left">æ­£åœ¨æ–­å¼€è¿æ¥</td>
</tr>
</tbody>
</table>
<p>ã€€ã€€å½“è®¾å¤‡å·²è¿æ¥æ—¶ï¼Œéœ€è¦é€šè¿‡ <code>discoverServices()</code> æŸ¥æ‰¾ GATT æœåŠ¡ï¼ŒæŸ¥æ‰¾æœåŠ¡è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œé‡å†™çš„ç¬¬äºŒä¸ªæ–¹æ³• <code>onServicesDiscovered</code>ã€‚</p>
<h4 id="äºŒã€onServicesDiscovered"><a href="#äºŒã€onServicesDiscovered" class="headerlink" title="äºŒã€onServicesDiscovered"></a><strong>äºŒã€onServicesDiscovered</strong></h4><p>å¯ä»¥åœ¨æ­¤æ–¹æ³•ä¸­è·å– <em>GATT çš„æœåŠ¡åˆ—è¡¨</em>ï¼Œè¿™ä¸ªæœåŠ¡åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªæœåŠ¡å¯¹åº”ç€ä¸€ä¸ª <em>BluetoothGattCharacteristicï¼ˆç”¨äºé€šä¿¡ï¼‰åˆ—è¡¨</em>ï¼Œéœ€è¦å¯¹è¿™ä¸ªåˆ—è¡¨é€šè¿‡ <em>UUID</em> è¿‡æ»¤å‡ºæˆ‘ä»¬æƒ³è¦çš„ <code>BluetoothGattCharacteristic</code>ï¼Œç„¶åå°±å¯ä»¥æ‹¿è¿™ä¸ª <code>BluetoothGattCharacteristic</code> è¿›è¡Œé€šä¿¡äº†ã€‚</p>
<blockquote>
<p>å…³äº UUID<br>é€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ (UUID) æ˜¯ç”¨äºå”¯ä¸€æ ‡è¯†ä¿¡æ¯çš„å­—ç¬¦ä¸² ID çš„ 128 ä½æ ‡å‡†åŒ–æ ¼å¼ã€‚ UUID çš„ç‰¹ç‚¹æ˜¯å…¶è¶³å¤Ÿåºå¤§ï¼Œå› æ­¤ä½ å¯ä»¥é€‰æ‹©ä»»æ„éšæœºå€¼è€Œä¸ä¼šå‘ç”Ÿå†²çªã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå®ƒè¢«ç”¨äºå”¯ä¸€æ ‡è¯†åº”ç”¨çš„è“ç‰™æœåŠ¡ã€‚ è¦è·å– UUID ä»¥ç”¨äºä½ çš„åº”ç”¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ç½‘ç»œä¸Šçš„ä¼—å¤šéšæœº UUID ç”Ÿæˆå™¨ä¹‹ä¸€ï¼Œç„¶åä½¿ç”¨ fromString(String) åˆå§‹åŒ–ä¸€ä¸ª UUIDã€‚ä¸å¿…è¿‡å¤šçº ç»“äº UUIDã€‚</p>
</blockquote>
<p>ä¸Šé¢è¿™ä¸ªè¿‡ç¨‹å¦‚æœç”¨ä¼ ç»Ÿçš„æ–¹å¼ç¼–å†™çš„è¯ï¼Œé‚£å°±æ˜¯<strong>åˆ—è¡¨éå†</strong>åµŒå¥—<strong>åˆ—è¡¨éå†</strong>å†åµŒå¥— <strong>if åˆ¤æ–­</strong> ï¼Œä¸‹æ¬¡å†çœ‹çš„è¯å°±æ˜¯ä¸€å †è¿·ä¹‹ç¼©è¿›ï¼Œè¿˜å¥½å¯ä»¥ç”¨ RxJava å†™å‡ºé“¾å¼çš„ç»“æ„ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServicesDiscovered</span><span class="params">(<span class="keyword">final</span> BluetoothGatt bleGatt, <span class="keyword">int</span> status)</span> </span>&#123;</span><br><span class="line">    Log.d(TAG, <span class="string">"onServicesDiscovered: æŸ¥æ‰¾æœåŠ¡: "</span> + bleGatt.getServices().size());</span><br><span class="line">    List&lt;BluetoothGattService&gt; serviceList = bleGatt.getServices();</span><br><span class="line">    Observable.from(serviceList)</span><br><span class="line">            .flatMap(<span class="keyword">new</span> Func1&lt;BluetoothGattService, Observable&lt;BluetoothGattCharacteristic&gt;&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> Observable&lt;BluetoothGattCharacteristic&gt; <span class="title">call</span><span class="params">(BluetoothGattService bleGattService)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> Observable.from(bleGattService.getCharacteristics());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .filter(<span class="keyword">new</span> Func1&lt;BluetoothGattCharacteristic, Boolean&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> Boolean <span class="title">call</span><span class="params">(BluetoothGattCharacteristic bleGattChar)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> bleGattChar.getUuid().toString().equals(UUID);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .subscribe(<span class="keyword">new</span> Action1&lt;BluetoothGattCharacteristic&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(BluetoothGattCharacteristic bleGattChar)</span> </span>&#123;</span><br><span class="line">                    bleGatt.setCharacteristicNotification(bleGattChar, <span class="keyword">true</span>);<span class="comment">//è®¾ç½®å¼€å¯æ¥æ”¶è“ç‰™æ•°æ®</span></span><br><span class="line">                    mBleGattChar = bleGattChar;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="ä¸‰ã€onCharacteristicChanged"><a href="#ä¸‰ã€onCharacteristicChanged" class="headerlink" title="ä¸‰ã€onCharacteristicChanged"></a><strong>ä¸‰ã€onCharacteristicChanged</strong></h4><p>æ­¤æ–¹æ³•ç”¨äº<strong>æ¥æ”¶è“ç‰™æ¨¡å—å‘é€è¿‡æ¥çš„æ•°æ®</strong>ï¼Œå®ƒæ˜¯å¼‚æ­¥çš„ï¼Œå¯ä»¥ç”¨ RxJava æ–¹ä¾¿çš„åˆ‡æ¢åˆ° Android ä¸»çº¿ç¨‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCharacteristicChanged</span><span class="params">(BluetoothGatt gatt, BluetoothGattCharacteristic characteristic)</span> </span>&#123;</span><br><span class="line">    Log.d(TAG, <span class="string">"onCharacteristicChanged"</span>);</span><br><span class="line">    String receiveData = <span class="keyword">new</span> String(characteristic.getValue());</span><br><span class="line">    Log.d(TAG, <span class="string">"æ”¶åˆ°è“ç‰™å‘æ¥æ•°æ®ï¼š"</span> + receiveData);</span><br><span class="line">    Observable.just(receiveData)</span><br><span class="line">            .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">            .subscribe(<span class="keyword">new</span> Action1&lt;String&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String receiveData)</span> </span>&#123;</span><br><span class="line">                    <span class="comment">//å¤„ç†receiveData</span></span><br><span class="line">                &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å‰é¢æåˆ°äº†æ•´ä¸ªè“ç‰™åŠŸèƒ½æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆåœ¨æˆ‘ä»¬æƒ³è¦çš„åœ°æ–¹ï¼ˆActivityï¼‰æ¥æ”¶åˆ°è¿™ä¸ª <code>receiveData</code> å‘¢ï¼Ÿä¹Ÿè®¸ä½ ä¼šè¯´å¯ä»¥åœ¨è¿™é‡Œå†™ä¸€ä¸ªæ¥å£å›è°ƒå•Šï¼Œæ˜¯çš„æ²¡é—®é¢˜ã€‚åœ¨äº†è§£åˆ°å¯ä»¥é€šè¿‡ RxJava å®ç° EventBus äº‹ä»¶æ€»çº¿åï¼Œæˆ‘æƒ³å¯ä»¥å†™ä¸€ä¸ªç®€å•çš„<code>RxBus</code> åœ¨è¿™é‡Œå‘å°„æ•°æ®ï¼Œåœ¨éœ€è¦çš„åœ°æ–¹è®¢é˜…å¹¶æ¥å—æ•°æ®ã€‚</p>
<blockquote>
<p>å…³äº RxBusï¼Œä½ å¯ä»¥å…ˆçœ‹<a href="http://blog.kaush.co/2014/12/24/implementing-an-event-bus-with-rxjava-rxbus/" target="_blank" rel="noopener">implementing-an-event-bus-with-rxjava-rxbus</a>ï¼Œç„¶åå¯ä»¥çœ‹<a href="https://medium.com/@czyrux/state-propagation-in-android-with-rxjava-subjects-81db49a0dd8e#.itt7wf5zt" target="_blank" rel="noopener">state-propagation-in-android-with-rxjava-subjects</a>ï¼ˆéœ€è¦ç§‘å­¦ä¸Šç½‘ï¼‰ã€‚æ­¤å¤–ï¼Œå›½å†…ä¹Ÿæœ‰å¾ˆå¤šç›¸å…³æ–‡ç« ã€‚</p>
</blockquote>
<p>å…ˆå®šä¹‰ä¸€ä¸ª <code>Subject</code>ï¼Œå®ƒæ—¢æ˜¯è§‚å¯Ÿè€…åˆæ˜¯è¢«è§‚å¯Ÿè€…<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Subject&lt;String, String&gt; mBus = <span class="keyword">new</span> SerializedSubject&lt;&gt;(PublishSubject.&lt;String&gt;create());</span><br></pre></td></tr></table></figure></p>
<p>ç„¶ååœ¨ <strong>å¤„ç† receiveData</strong> çš„åœ°æ–¹å‘å°„æ•°æ®<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mBus.onNext(receiveData);</span><br></pre></td></tr></table></figure></p>
<p>å†å®šä¹‰ä¸€ä¸ªæ–¹æ³•ç”¨äºæ¥æ”¶æ•°æ®<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Observable&lt;String&gt; <span class="title">receiveData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mBus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€ååœ¨éœ€è¦æ¥æ”¶æ•°æ®çš„åœ°æ–¹è®¢é˜…<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mRxBle.receiveData().subscribe(<span class="keyword">new</span> Action1&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String receiveData)</span> </span>&#123;</span><br><span class="line">        sendTv.setText(mStringBuffer.append(receiveData).append(<span class="string">"\n"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="å‘è“ç‰™è®¾å¤‡å‘é€æ•°æ®"><a href="#å‘è“ç‰™è®¾å¤‡å‘é€æ•°æ®" class="headerlink" title="å‘è“ç‰™è®¾å¤‡å‘é€æ•°æ®"></a>å‘è“ç‰™è®¾å¤‡å‘é€æ•°æ®</h2><p>é€šä¿¡ä¸ä»…ä»…æ˜¯æ¥æ”¶æ•°æ®ï¼Œè¿˜éœ€è¦å‘é€æ•°æ®ï¼Œè¿™ä¸ªå®ç°èµ·æ¥å¾ˆç®€å•ï¼Œåªè¦ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰æ‹¿åˆ°çš„ <code>BluetoothGattCharacteristic</code> å¯¹è±¡ä»¥åŠ<code>BluetoothGatt</code> å¯¹è±¡è¿›è¡Œç›¸å…³æ–¹æ³•çš„è°ƒç”¨å°±è¡Œï¼Œåœ¨é¡¹ç›®ä¸­ç”±äºéœ€è¦å¯¹æ•°æ®è¿›è¡Œå»¶æ—¶å‘é€ï¼Œæ‰€ä»¥ä¹Ÿç”¨åˆ°äº† <code>timer</code>ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Observable.timer(time, TimeUnit.MILLISECONDS)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Action1&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Long l)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (mBleGatt != <span class="keyword">null</span> &amp;&amp; mBleGattChar != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    mBleGattChar.setValue(data);<span class="comment">//è®¾ç½®æ•°æ®</span></span><br><span class="line">                    <span class="keyword">boolean</span> isSend = mBleGatt.writeCharacteristic(mBleGattChar);<span class="comment">//å†™å…¥ï¼ˆå‘é€ï¼‰æ•°æ®</span></span><br><span class="line">                    Log.d(TAG, <span class="string">"å‘é€ï¼š"</span> + (isSend ? <span class="string">"æˆåŠŸ"</span> : <span class="string">"å¤±è´¥"</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure></p>
<p>RxJava çš„å¼ºå¤§ä¹‹å¤„åœ¨äºä»–æœ‰å„ç§å„æ ·çš„æ“ä½œç¬¦ï¼Œå¯ä»¥å¯¹å‘å¸ƒçš„æ•°æ®æºè¿›è¡Œå„ç§å„æ ·çš„å¤„ç†ï¼Œå®é™…é¡¹ç›®ä¸­æœ‰å¾ˆå¤šåº”ç”¨çš„åœºæ™¯ã€‚</p>
<p>ä¼ é€é—¨ï¼š<a href="https://github.com/bestTao/RxBleDemo" target="_blank" rel="noopener">RxBleDemo</a></p>
<p><br><br><br></p>
<hr>
<p><strong>å…³æ³¨å…¬ä¼—å·ï¼Œäº†è§£æ›´å¤šå“¦ï½</strong>ğŸ‘‡</p>
<p><img src="https://ws1.sinaimg.cn/large/82890cf6ly1g0svkchadyj20nw0nw40x.jpg" style="float:left;width:130px"></p>
<p><br><br><br><br><br></p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">ä¸»é¡µ</a></li>
         
          <li><a href="/archives/">åˆ—è¡¨</a></li>
         
          <li><a href="/emmm/">ç‰¢éªš</a></li>
         
          <li><a href="/about/">æˆ‘</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#æ•´ä½“æ€è·¯"><span class="toc-number">1.</span> <span class="toc-text">æ•´ä½“æ€è·¯</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#è¯¦ç»†æ­¥éª¤"><span class="toc-number">2.</span> <span class="toc-text">è¯¦ç»†æ­¥éª¤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#è®¾ç½®è“ç‰™æƒé™"><span class="toc-number">2.1.</span> <span class="toc-text">è®¾ç½®è“ç‰™æƒé™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è®¾ç½®å¹¶å¼€å¯æ‰‹æœºè“ç‰™è®¾å¤‡"><span class="toc-number">2.2.</span> <span class="toc-text">è®¾ç½®å¹¶å¼€å¯æ‰‹æœºè“ç‰™è®¾å¤‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æŸ¥æ‰¾è“ç‰™è®¾å¤‡"><span class="toc-number">2.3.</span> <span class="toc-text">æŸ¥æ‰¾è“ç‰™è®¾å¤‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è¿æ¥è“ç‰™æœåŠ¡å¹¶æ¥æ”¶æ•°æ®"><span class="toc-number">2.4.</span> <span class="toc-text">è¿æ¥è“ç‰™æœåŠ¡å¹¶æ¥æ”¶æ•°æ®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¸€ã€onConnectionStateChange"><span class="toc-number">2.4.0.1.</span> <span class="toc-text">ä¸€ã€onConnectionStateChange</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#äºŒã€onServicesDiscovered"><span class="toc-number">2.4.0.2.</span> <span class="toc-text">äºŒã€onServicesDiscovered</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¸‰ã€onCharacteristicChanged"><span class="toc-number">2.4.0.3.</span> <span class="toc-text">ä¸‰ã€onCharacteristicChanged</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‘è“ç‰™è®¾å¤‡å‘é€æ•°æ®"><span class="toc-number">2.5.</span> <span class="toc-text">å‘è“ç‰™è®¾å¤‡å‘é€æ•°æ®</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&text=RxJava + BLE"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&title=RxJava + BLE"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&is_video=false&description=RxJava + BLE"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=RxJava + BLE&body=Check out this article: https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&title=RxJava + BLE"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&title=RxJava + BLE"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&title=RxJava + BLE"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&title=RxJava + BLE"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://qiantao94.github.io/2016/11/25/ä½¿ç”¨RxJavaå¸®åŠ©ä½åŠŸè€—è“ç‰™(BLE)è¿›è¡Œé€šä¿¡/&name=RxJava + BLE&description=&lt;p&gt;åŸºç¡€æ•™ç¨‹ï¼åŸºç¡€æ•™ç¨‹ï¼&lt;br&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 qiantao
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">ä¸»é¡µ</a></li>
         
          <li><a href="/archives/">åˆ—è¡¨</a></li>
         
          <li><a href="/emmm/">ç‰¢éªš</a></li>
         
          <li><a href="/about/">æˆ‘</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-120844447-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'Salama';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


